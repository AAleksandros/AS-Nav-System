# =============================================================================
# Autonomous Navigation Agent — APF Simulator Configuration
# =============================================================================

control:
  start_x: 320.0
  start_y: 400.0
  start_heading: 90.0
  agent_speed: 2.0
  turn_rate: 5.0
  trajectory_length: 100

environment:
  width: 800.0                    # world width in units
  height: 600.0                   # world height in units
  agent_radius: 8.0               # agent collision radius
  scenarios:
    corridor:
      static_obstacles:
        # Upper wall forming corridor boundary
        - { x: 200, y: 420, radius: 35 }
        - { x: 400, y: 380, radius: 35 }  # narrows in middle
        - { x: 600, y: 420, radius: 35 }
        # Lower wall forming corridor boundary
        - { x: 200, y: 180, radius: 35 }
        - { x: 400, y: 220, radius: 35 }  # narrows in middle
        - { x: 600, y: 180, radius: 35 }
      dynamic_obstacles: []
      waypoints:
        - [100, 300]
        - [700, 300]
      start: [50, 300]
      start_heading: 0.0          # radians (0 = east)
    gauntlet:
      static_obstacles:
        - { x: 200, y: 300, radius: 40 }
        - { x: 400, y: 180, radius: 40 }
        - { x: 400, y: 420, radius: 40 }
        - { x: 600, y: 300, radius: 40 }
      dynamic_obstacles: []
      waypoints:
        - [100, 300]
        - [700, 300]
      start: [50, 300]
      start_heading: 0.0
    dynamic:
      static_obstacles:
        - { x: 300, y: 300, radius: 40 }
        - { x: 500, y: 300, radius: 40 }
      dynamic_obstacles:
        - { x: 200, y: 150, radius: 20, vx: 30, vy: 20 }
        - { x: 600, y: 450, radius: 20, vx: -25, vy: -15 }
      waypoints:
        - [400, 100]
        - [400, 500]
        - [700, 300]
      start: [50, 300]
      start_heading: 0.0
    slalom:
      static_obstacles:
        - { x: 200, y: 400, radius: 35 }   # upper-left
        - { x: 350, y: 200, radius: 35 }   # lower-center-left
        - { x: 500, y: 400, radius: 35 }   # upper-center-right
        - { x: 650, y: 200, radius: 35 }   # lower-right
      dynamic_obstacles: []
      waypoints:
        - [100, 300]
        - [700, 300]
      start: [50, 300]
      start_heading: 0.0
    narrow_gap:
      static_obstacles:
        - { x: 400, y: 100, radius: 60 }   # bottom wall
        - { x: 400, y: 230, radius: 40 }   # lower-middle wall
        - { x: 400, y: 380, radius: 40 }   # upper-middle wall
        - { x: 400, y: 510, radius: 60 }   # top wall
      dynamic_obstacles: []
      waypoints:
        - [100, 300]
        - [700, 300]
      start: [50, 300]
      start_heading: 0.0
    u_turn:
      static_obstacles:
        - { x: 300, y: 300, radius: 60 }   # big center obstacle
        - { x: 550, y: 200, radius: 30 }   # minor obstacle to shape path
      dynamic_obstacles: []
      waypoints:
        - [100, 300]
        - [600, 300]
      start: [50, 300]
      start_heading: 0.0
    crossing:
      static_obstacles:
        - { x: 200, y: 150, radius: 30 }   # corner obstacle
        - { x: 600, y: 450, radius: 30 }   # corner obstacle
      dynamic_obstacles:
        - { x: 350, y: 50, radius: 25, vx: 0, vy: 50 }    # moves up
        - { x: 450, y: 550, radius: 25, vx: 0, vy: -50 }   # moves down
      waypoints:
        - [100, 300]
        - [400, 300]
        - [700, 300]
      start: [50, 300]
      start_heading: 0.0
    dense:
      static_obstacles:
        - { x: 150, y: 200, radius: 20 }
        - { x: 200, y: 420, radius: 18 }
        - { x: 280, y: 300, radius: 22 }
        - { x: 350, y: 150, radius: 20 }
        - { x: 380, y: 450, radius: 25 }
        - { x: 430, y: 320, radius: 18 }
        - { x: 500, y: 200, radius: 22 }
        - { x: 530, y: 430, radius: 20 }
        - { x: 580, y: 300, radius: 25 }
        - { x: 650, y: 180, radius: 18 }
        - { x: 680, y: 420, radius: 22 }
      dynamic_obstacles: []
      waypoints:
        - [100, 300]
        - [400, 150]
        - [700, 450]
      start: [50, 300]
      start_heading: 0.0

sensor:
  num_rays: 36                    # number of sensor rays
  max_range: 250.0                # maximum detection range
  fov: 6.283185307                # field of view in radians (2*pi = 360°)
  noise_stddev: 1.0               # Gaussian noise std deviation
  noise_seed: null                # random seed for reproducibility (null = random)

planner:
  k_att: 20.0                    # attractive force gain
  k_rep: 80.0                    # repulsive force gain (linear field)
  influence_range: 120.0          # repulsive force influence range
  goal_tolerance: 15.0            # distance to consider goal reached
  max_speed: 80.0                 # maximum agent speed (units/s)
  escape_threshold: 2.0           # position change threshold for stuck detection
  escape_window: 30               # number of steps to track for stuck detection
  escape_force: 80.0              # magnitude of random escape perturbation
  slow_down_distance: 40.0        # decelerate when obstacle within this range
  cruise_fraction: 0.4            # cruise at this fraction of max_speed
  vortex_weight: 0.7              # 0.0 = pure APF, 1.0 = pure vortex
  force_smoothing: 0.3            # EMA alpha (0 = full previous, 1 = no smoothing)
  symmetry_threshold: 0.3         # net/sum ratio below which nudge activates
  symmetry_nudge_force: 40.0      # magnitude of symmetry-breaking force
  forward_half_angle: 1.047       # radians (~60°) — forward cone with full repulsion
  rear_attenuation: 0.1           # min force multiplier for obstacles directly behind
  attenuation_power: 2.0          # power exponent for cosine taper (steeper = less side force)
  commitment_duration: 15          # steps to hold committed bypass direction
  commitment_force: 30.0           # magnitude of gap-steering force

controller:
  kp: 4.0                        # PID proportional gain
  ki: 0.1                        # PID integral gain
  kd: 0.15                       # PID derivative gain
  max_omega: 6.0                  # max angular velocity (rad/s)
  integral_limit: 2.0             # anti-windup integral clamp
  trajectory_length: 500          # max trajectory points to store

visualization:
  show_obstacles: true
  show_sensor_rays: true
  show_force_vectors: true
  show_state: true
  show_agent: true
  show_trajectory: true
  show_metrics: true
  show_waypoints: true
  show_goal_status: true
  colors:
    background: [40, 40, 40]       # dark gray
    grid: [60, 60, 60]             # lighter gray
    boundary: [200, 200, 200]      # light gray
    agent: [0, 200, 255]           # cyan
    trajectory: [100, 100, 255]    # light blue
    waypoint: [255, 255, 0]        # yellow
    waypoint_reached: [100, 100, 100]  # gray
    obstacle_fill: [80, 80, 80]    # dark gray
    obstacle_outline: [200, 200, 200]  # light gray
    sensor_ray_miss: [60, 60, 60]  # dim gray
    sensor_ray_hit: [255, 80, 80]  # red
    force_attractive: [0, 255, 100]  # green
    force_repulsive: [255, 80, 80]   # red
    force_total: [0, 255, 255]       # cyan
    state_navigate: [0, 255, 0]    # green
    state_avoid: [255, 165, 0]     # orange
    state_stop: [255, 0, 0]        # red
  force_vector_scale: 3.0          # scale factor for force arrow length
  sensor_ray_alpha: 0.3            # opacity for sensor rays

simulation:
  dt: 0.033                       # time step in seconds (~30 fps)
  max_steps: 3000                 # maximum simulation steps
  fps: 30                         # output video FPS
  video_width: 800                # output video width (pixels)
  video_height: 600               # output video height (pixels)

logging:
  level: "INFO"
  log_file: "logs/navigation.log"
  log_to_console: true
